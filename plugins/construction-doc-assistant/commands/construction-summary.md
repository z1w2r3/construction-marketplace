# 建筑施工项目总结生成（智能版 v2.0）

生成专业的项目总结报告，支持智能模板匹配和用户自定义要求。

---

## 📋 命令参数说明

```bash
/construction-summary [范围] [--template <类型>] [--structure <结构>] [--focus <重点>] [--format <格式>] [--depth <深度>]
```

**参数说明**：
- `[范围]`：可选，总结范围（如"智能建造"、"2024年度"、"主体结构阶段"）
- `--template`：可选，指定报告模板（trial_project、technical、acceptance、progress、summary）
- `--structure`：可选，自定义章节结构（用"|"分隔，如"项目概况|技术应用|成效分析"）
- `--focus`：可选，重点内容关键词（用","分隔，如"BIM应用,机器人效率,成本节约"）
- `--format`：可选，报告正式程度（formal=正式、brief=简要、detailed=详细）
- `--depth`：可选，数据提取深度（summary=概要、full=完整）

**示例**：
```bash
# 智能识别（推荐）
/construction-summary

# 指定范围
/construction-summary 智能建造

# 指定模板
/construction-summary --template trial_project

# 完全自定义
/construction-summary 2024年度 --structure "项目概况|主要工作|经验总结" --focus "BIM,机器人,成本"
```

---

## 🚀 执行流程

你现在要执行项目总结生成任务，参数: $ARGUMENTS

### 第一步：读取项目配置和模板系统

#### 1.1 读取项目配置

使用 Read 工具读取 `.claude/CLAUDE-construction.md`：
```
如果文件不存在：
  → 提示用户先运行 /construction-init 初始化项目
  → 终止执行

如果文件存在：
  → 提取以下信息：
    - 项目名称
    - 原文档目录路径
    - 项目类型
    - 参建单位信息
    - 工程地点
```

#### 1.2 读取模板配置

使用 Read 工具读取 `${CLAUDE_PLUGIN_ROOT}/templates/report_templates.json`：
```
获取：
- 5种报告模板定义
- 模板匹配规则
- 引用格式规范
- 过滤规则
```

#### 1.3 读取模板匹配指南

使用 Read 工具读取 `${CLAUDE_PLUGIN_ROOT}/templates/template_matcher.md`：
```
获取：
- 智能匹配算法详细说明
- 深度内容提取策略
- 专业报告生成规范
- 质量检查清单
```

**重要**：这两个文件是生成高质量报告的关键指南，必须仔细阅读并严格遵守！

---

### 第二步：解析用户需求和智能模板匹配

#### 2.1 解析命令参数

分析 $ARGUMENTS，提取：
- 范围：时间范围、阶段范围、专业范围
- 模板类型：用户指定或待智能识别
- 自定义结构：用户指定的章节
- 重点关键词：用户关注的内容
- 格式和深度：报告正式程度和数据详细度

#### 2.2 交互式需求收集（如果用户未提供参数）

如果用户没有提供 --template 参数，询问：

```
📋 生成项目总结报告

请选择报告类型（直接输入数字，或按回车使用智能识别）：

1️⃣  试点项目报告 - 适用于智能建造试点、示范项目等申报材料
2️⃣  专项技术报告 - 适用于BIM应用、机器人应用等技术总结
3️⃣  验收汇报材料 - 适用于工程验收、检查、评审等正式场合
4️⃣  进度分析报告 - 适用于进度分析、进度偏差分析等
5️⃣  项目总结报告 - 适用于综合性总结、年度总结、阶段总结
6️⃣  自定义结构 - 手动指定章节和重点
7️⃣  智能识别 - 根据文档内容自动选择最合适的模板 ✨推荐

您的选择：[默认 7]
```

如果选择"智能识别"或直接回车，继续下一步。
如果选择1-5，记录用户选择的模板类型。
如果选择6，询问自定义章节结构。

如果用户没有提供 --focus 参数，询问：

```
📝 报告重点内容（可选）

请输入您希望重点关注的内容关键词（用逗号分隔），或直接回车跳过：
示例：BIM应用成效、机器人效率数据、成本对比分析

您的要求：[留空则全面覆盖]
```

如果用户没有提供 --depth 参数，询问：

```
📊 数据提取深度

1️⃣  概要型 - 快速生成，包含主要信息 ⚡（推荐）
2️⃣  详细型 - 深度解析，包含所有数据表格 📈

您的选择：[默认 1]
```

---

### 第三步：文档扫描和智能分析

#### 3.1 扫描原文档目录

使用 Bash 工具扫描文档：

```bash
# 扫描所有支持的文档类型
find "原文档目录" -type f \( \
  -name "*.docx" -o \
  -name "*.xlsx" -o \
  -name "*.pptx" -o \
  -name "*.pdf" \
\) | head -50
```

**处理逻辑**：
- 如果找到0个文档：提示"未找到任何文档，请检查原文档目录配置"，终止
- 如果找到1-10个文档：全部读取
- 如果找到11-30个文档：按优先级读取前15个
- 如果找到>30个文档：按优先级读取前20个

#### 3.2 文档优先级排序

**高优先级（必读）**：
- 文件名包含：概况、总结、汇报、报告、方案、实施、试点、示范
- 文件类型：PPT（通常是汇报材料）

**中优先级（重要）**：
- 文件名包含：应用、分析、管理、平台、数据、计划
- 文件类型：Word文档（技术报告）

**低优先级（辅助）**：
- 文件名包含：记录、检查、测试、模板
- 文件类型：Excel（数据表格）、PDF（可能是扫描件）

**排序算法**：
```
优先级得分 = 文件名关键词得分 + 文件类型得分 + 文件大小得分
按得分降序排列，选择前N个文档读取
```

#### 3.3 提取文档关键词（用于模板匹配）

对所有文档文件名进行关键词统计：

**试点项目关键词**：试点、示范、申报、智能建造、创新、成效
**技术报告关键词**：BIM、机器人、技术、应用、参数、智能装备
**验收材料关键词**：验收、检查、评审、竣工、质量、资料
**进度报告关键词**：进度、计划、工期、节点、偏差
**综合总结关键词**：总结、年度、阶段、回顾、项目

统计各类关键词出现次数，计算匹配度。

#### 3.4 智能模板匹配（如果用户未指定）

根据 `template_matcher.md` 中的算法：

```
1. 关键词匹配得分（权重40%）
   - 统计文档名称中各类关键词出现频率
   - 计算每个模板的关键词匹配度

2. 文档类型分析（权重30%）
   - 分析文档类型分布（Word/Excel/PPT/PDF）
   - 判断最可能的报告类型

3. 目录结构分析（权重30%）
   - 分析文档目录层级结构
   - 识别特征性目录（如"BIM数字一体化设计"）

4. 综合判断
   - 综合得分 = 关键词得分×0.4 + 类型得分×0.3 + 结构得分×0.3
   - 如果最高得分 > 0.6，选择该模板
   - 否则使用"项目总结"默认模板
```

**输出选择结果**：
```
🎯 智能分析结果：

根据文档分析，推荐使用：**试点项目报告**模板

匹配依据：
- 关键词匹配度：85%（发现"试点"、"智能建造"、"示范"等关键词）
- 文档类型特征：包含实施方案、汇报PPT、应用报告等
- 目录结构特征：包含"组织体系"、"BIM应用"、"机器人应用"等分类

是否使用该模板？[Y/n]：
```

如果用户回车或输入Y，使用推荐模板。
如果用户输入n，让用户手动选择模板（回到第二步交互）。

---

### 第四步：深度文档解析和内容提取 ⭐核心

**⚠️ 极其重要：必须严格遵守 template_matcher.md 中的"深度内容提取策略"！**

#### 4.1 文档验证和解析

对每个选中的文档，按顺序执行：

**步骤1：验证文档可读性**
```
调用：mcp__construction_doc_processor__validate_document
参数：
  file_path: [文档绝对路径]

如果 valid = false：
  记录到失败列表，跳过该文档
```

**步骤2：根据类型调用解析工具**
```
# Word文档
mcp__construction_doc_processor__parse_word_document
参数：
  file_path: [文档路径]
  extract_tables: true
  keywords: ["效率", "成本", "质量", "数据", "提升", "百分比"]

# Excel文档
mcp__construction_doc_processor__parse_excel_document
参数：
  file_path: [文档路径]
  max_rows: 100

# PowerPoint文档
mcp__construction_doc_processor__parse_powerpoint_document
参数：
  file_path: [文档路径]
  max_slides: 50
  extract_notes: true

# PDF文档
mcp__construction_doc_processor__parse_pdf_document
参数：
  file_path: [文档路径]
  max_pages: 50
  extract_tables: false
```

#### 4.2 关键信息提取（重中之重）

**⚠️ 绝对不要的表述**：
- ❌ "文档包含31个表格"
- ❌ "文档有20个章节"
- ❌ "根据关键词提取"

**✅ 必须做的事情**：

**(1) 从Word文档提取实质内容**：
- 读取包含数字的段落（效率、成本、质量数据）
- 提取表格中的关键数值
- 提取结论性语句
- 提取对比数据

**处理示例**：
```
# 原始解析结果包含：
表格数据：
| 作业类型 | 传统方式 | 机器人 | 提升幅度 |
| 地面整平 | 1500㎡/天 | 4200㎡/天 | 180% |

# 必须提取为专业表述：
"四轮激光整平机器人作业效率4200㎡/天，相比传统人工1500㎡/天，
效率提升180%。以7#实验楼为例，传统方式需28天完成，机器人仅需10天，
缩短工期18天。"
```

**(2) 从Excel文档提取统计数据**：
- 读取标题行，理解数据含义
- 统计数值列（总数、平均值、最大最小值）
- 识别时间跨度
- 读取汇总行

**处理示例**：
```
# 原始解析结果：37行实施计划数据

# 必须提取为实质内容：
"项目实施计划涵盖8个应用方向、37项具体任务，实施周期为2024年3月至12月。
重点任务包括：
1. BIM数字化设计（3-5月完成）
2. 智能管理平台上线（6月完成）
3. 建筑机器人应用（7-10月持续）"
```

**(3) 从PowerPoint提取核心成果**：
- 提取幻灯片标题（章节结构）
- 提取关键数据（图表、数字）
- 提取备注内容（详细说明）
- 提取总结页内容

**处理示例**：
```
# 原始解析结果：24张幻灯片

# 必须提取为实质内容：
"项目汇报材料系统展示了三大板块成果：

【BIM应用板块】
- 完成全专业BIM建模，模型精度达LOD400
- BIM AI审图发现设计问题58处，提前消除施工隐患
- 基于BIM进行碳排放测算，优化设计降低碳排放12%

【智能管理板块】
- 建立项目管理平台，集成6大系统
- 实现进度、质量、安全的实时监控
- 数据自动统计，管理效率提升40%"
```

#### 4.3 组合分析和交叉验证

当多个文档内容相关时，进行整合：

```
实施方案（Word）→ 总体框架和目标
  +
应用报告（Word）→ 详细数据和分析
  +
实施计划（Excel）→ 时间节点和任务分解
  +
汇报材料（PPT）→ 提炼的核心成果
  =
综合报告（深度整合，数据充实）
```

#### 4.4 内部记录（不输出到报告）

在内部维护一个结构化数据：

```json
{
  "documents_processed": [
    {
      "name": "智能建造实施方案.docx",
      "status": "success",
      "extracted_data": {
        "key_points": ["大力推广新型建造方式", "推进BIM技术应用"],
        "numeric_data": {},
        "tables": [
          {
            "title": "组织架构表",
            "rows": 5,
            "key_data": "..."
          }
        ]
      }
    },
    {
      "name": "机器人应用报告.docx",
      "status": "success",
      "extracted_data": {
        "key_points": ["效率提升180%", "成本降低28%"],
        "numeric_data": {
          "efficiency_improvement": "180%",
          "cost_reduction": "28%",
          "area_covered": "4.2万㎡"
        },
        "tables": [...]
      }
    }
  ],
  "summary_data": {
    "total_docs": 5,
    "success": 5,
    "failed": 0
  }
}
```

---

### 第五步：按模板生成专业报告 ⭐核心

**⚠️ 必须严格遵守 template_matcher.md 中的"专业报告内容生成规范"！**

#### 5.1 生成封面页

```markdown
---

**[项目名称]**

**[报告类型]**

编制单位：[从配置文件读取]
编制日期：[格式：2024年10月15日]

---

| 岗位 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| 编制 | _____ | _____ | _____ |
| 审核 | _____ | _____ | _____ |
| 批准 | _____ | _____ | _____ |

---
```

#### 5.2 生成目录占位

```markdown
# [项目名称][报告类型]

## 目录
[待Word生成时自动生成]

---
```

#### 5.3 按模板结构生成正文

根据选定的模板（来自 report_templates.json），按章节生成内容。

**以"试点项目报告"模板为例**：

```markdown
## 一、项目背景与意义

### 1.1 项目基本信息

**项目名称**：[从配置读取]

**建设地点**：[从配置或文档读取]

**建设规模**：[从文档提取]
根据《[文档名称]》，本项目总建筑面积XX万平方米，其中...

**参建单位**：
- 建设单位：[从配置读取]
- 施工总承包：[从配置读取]
- 监理单位：[从配置读取]

### 1.2 试点背景

根据《[文档名称]》，本项目作为[省/市]智能建造试点项目，旨在...

[从实施方案文档提取的背景内容，转换为专业语言]

---

## 二、试点目标与任务

### 2.1 总体目标

根据《[文档名称]》，本项目总体目标包括：

[从实施方案提取的目标，列表呈现]

### 2.2 具体任务

根据《[文档名称]》，项目具体任务涵盖X个方向、XX项任务：

[从实施计划Excel提取的任务分解，转换为专业描述]

---

## 三、组织保障体系

[从组织架构文档提取]

---

## 四、技术应用与实施

### 4.1 BIM技术应用

根据《[文档名称]》，本项目BIM技术应用包括：

**(1) 数字化建模**
- 完成全专业BIM建模，模型精度达LOD400
- 模型文件大小XX GB，构件数量XX万个

**(2) BIM辅助审查**
- 应用BIM AI审图技术，发现设计问题XX处
- 提前消除施工隐患，避免返工损失约XX万元

[从BIM应用报告提取的实质内容和数据]

### 4.2 建筑机器人应用

根据《[文档名称]》，本项目应用X类建筑机器人，累计作业面积XX万㎡。

#### (1) 四轮激光整平机器人

**应用范围**：7#实验楼地下室及1-12层楼面整平作业

**应用成效**：

- **效率大幅提升**：机器人作业效率4200㎡/天，传统人工1500㎡/天，
  效率提升180%。以7#实验楼为例，传统方式需28天完成，机器人仅需10天。

- **质量显著改善**：地面平整度±2mm，传统工艺±5mm，精度提升60%。
  经第三方检测，合格率100%，优良率98%。

- **成本有效控制**：单位面积成本12元/㎡，传统成本16.5元/㎡，
  降低27.3%，节约成本约18.9万元。

[从机器人应用报告提取的详细数据和分析]

#### (2) [其他机器人类型]

[同样方式提取和呈现]

---

## 五、应用成效与数据支撑

### 5.1 经济效益

**直接成本节约**：
根据各项技术应用的成本统计，项目累计节约成本约XX万元，其中：
- BIM技术应用节约XX万元
- 建筑机器人应用节约XX万元
- 智能管理平台节约XX万元

[提取并汇总各文档中的成本数据]

**工期效益**：
通过技术优化和穿插施工，累计缩短工期XX天，按工期价值X万元/天计算，
工期效益约XX万元。

### 5.2 社会效益

[从文档提取社会效益内容]

---

## 六、创新亮点与特色

### 6.1 技术创新

[从各技术报告提取创新点，归纳总结]

### 6.2 管理创新

[从管理类文档提取创新点]

---

## 七、经验总结与推广价值

### 7.1 成功经验

根据项目实施过程，主要成功经验包括：

**经验1：顶层设计先行**
[从实施方案提取]

**经验2：技术应用全面**
[从应用报告提取]

### 7.2 推广价值

[总结推广价值]

---

## 八、持续改进计划

[从实施计划或总结文档提取]

---

## 附件

本报告相关支撑材料包括：

1. 《[文档名称]》（编制日期）
2. 《[文档名称]》（编制日期）
...

以上材料存档于项目技术资料室，可供查阅。

---

**报告编制说明**

本报告基于项目技术资料编制，所有数据来源于原始文档和现场统计记录。
建议使用时结合实际情况进行必要调整和补充。

**编制日期**：2024年10月15日
```

#### 5.4 数据引用格式规范

**✅ 正确格式**：
```markdown
根据《苏州一建518地块智能建造实施方案》（2024年8月编制），
本项目总体要求包括...

根据《建筑机器人施工应用分析报告》统计，四轮激光整平机器人
累计作业面积达4.2万平方米，效率提升180%...

经现场实测和第三方检测，机器人作业地面平整度达到±2mm...
```

**❌ 错误格式**：
```markdown
**来源**: 《智能建造实施方案.docx》(41个章节,48段落,3个表格)
路径: /Volumes/MOVESPEED/projectDocs2/...
```

#### 5.5 质量自查

生成报告后，必须进行自查（对照 template_matcher.md 第五节"质量检查清单"）：

**内容质量检查**：
- [ ] 所有章节都有实质性内容（不是空洞描述）
- [ ] 包含具体数据（百分比、数值、对比）
- [ ] 数据有明确来源（但格式规范）
- [ ] 语言专业，符合建筑行业习惯

**技术痕迹检查**：
- [ ] 没有"成功读取X个文档"
- [ ] 没有"文档包含X段落/章节/表格"
- [ ] 没有"根据关键词提取"
- [ ] 没有内部路径（/Volumes/...）
- [ ] 没有过多表情符号（最多✓×）
- [ ] 没有"## 文档读取情况"章节（如果有，删除）
- [ ] 没有"## 报告质量说明"章节（如果有，删除）

如果发现不符合项，必须修正后再保存！

---

### 第六步：保存Markdown报告

使用 Write 工具保存到：

```
生成文件/项目总结/[报告类型]-[范围]-YYYYMMDD-HHMMSS.md
```

**文件名规范**：
- 试点项目报告：`试点项目总结报告-20241015-143500.md`
- 专项技术报告：`BIM技术应用报告-20241015-143500.md`
- 验收汇报材料：`工程验收汇报材料-20241015-143500.md`
- 进度分析报告：`进度分析报告-2024年9月-20241015-143500.md`
- 项目总结报告：`项目总结报告-2024年度-20241015-143500.md`

---

### 第七步：生成Word文档

#### 7.1 调用Word生成工具

```
mcp__construction_doc_processor__generate_word_report:
  markdown_file: [第六步保存的Markdown文件绝对路径]
  output_file: [同目录，扩展名改为.docx]
  template_type: [根据报告类型选择]
    - trial_project → "inspection_report"
    - technical → "inspection_report"
    - acceptance → "inspection_report"
    - progress → "progress_analysis"
    - summary → "project_summary"
  project_info:
    project_name: [从配置读取]
    report_type: [报告类型中文名称]
    generate_date: [当前日期 YYYY-MM-DD]
```

#### 7.2 处理生成结果

**成功**：继续第八步
**失败**：提示用户"Word生成失败，Markdown报告已保存，可稍后手动转换"，继续第八步

---

### 第八步：输出完成信息

```
✅ 项目总结报告生成完成

📄 生成文件：
  - Markdown报告：生成文件/项目总结/[文件名].md
  - Word文档：生成文件/项目总结/[文件名].docx

📊 报告信息：
  - 报告类型：[类型名称]
  - 文档依据：基于 X 个项目技术文档
  - 报告长度：约 XXXX 字
  - Word文件大小：XX MB

📋 主要内容：
  [列出主要章节名称]

💡 使用建议：
  1. 建议直接打开Word文档进行审阅和编辑
  2. 对比原始文档验证关键数据的准确性
  3. 根据实际需要补充或调整内容
  4. Markdown文件作为源文件保留，便于后续重新生成

✅ 报告已可直接使用，无需大幅修改！
```

---

## 🎯 核心改进总结

### 与旧版本的本质区别

**旧版本问题**：
- ❌ 报告充斥"成功读取5个文档"等技术信息
- ❌ 只说"包含31个表格"，不提取表格数据
- ❌ 暴露AI痕迹，"根据关键词提取"等表述
- ❌ 缺少封面、审批栏等正式报告要素
- ❌ 使用固定结构，不能适应不同类型报告

**新版本优势**：
- ✅ 纯净专业的报告内容，零技术痕迹
- ✅ 深度提取数据，"效率提升180%"等实质内容
- ✅ 智能模板匹配，自动选择最合适的报告结构
- ✅ 标准封面页、目录、审批栏，符合行业规范
- ✅ 支持用户自定义，灵活满足各种需求
- ✅ 生成的报告直接可交付，无需二次编辑

---

**重要提醒**：
在执行本命令时，必须始终参考和遵守：
1. `report_templates.json` - 模板定义和配置
2. `template_matcher.md` - 详细的生成规范和示例

这两个文件是生成高质量专业报告的核心指南！
