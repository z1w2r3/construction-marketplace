---
name: report-structure
description: "报告结构规划技能 - 根据主题和类型生成专业报告大纲。支持研究报告、总结报告、对比报告、分析报告等多种类型,自动分配数据源"
---

# Report Structure Skill
报告结构规划技能 - 根据主题和类型生成专业报告大纲

## 技能说明
根据报告主题和类型,自动生成专业的报告大纲结构。

**核心升级** (来自文章启发):
- ✅ 强制引用来源:所有事实性陈述必须标注来源
- ✅ 禁止编造:明确区分"来自文档"和"AI知识"
- ✅ 三遍审校:自动执行内容/风格/细节审校

## 输入参数
- `topic`: 报告主题
- `report_type`: 报告类型(research/summary/comparison/analysis)
- `audience`: 目标读者(executive/technical/general)
- `knowledge_base_path`: 知识库路径
- `generate_alternatives`: 是否生成多方案(默认 false) ⭐ 新增

---

## 核心原则 (绝不妥协) ⭐ 新增

在报告生成的所有环节,必须遵循:

1. **绝不编造数据或信息**
   - ❌ 禁止:使用模型训练数据中的知识(除非明确标注"来自AI知识库")
   - ✅ 允许:基于文档的合理推断(但必须标注"基于XX推断")

2. **强制引用来源**
   - ❌ 错误示例:"项目采用了先进的微服务架构..."
   - ✅ 正确示例:"根据《技术方案设计》(第5页),项目采用微服务架构..."

3. **明确标注不确定信息**
   - 如果文档中没有明确答案,必须标注:
     - "文档库中未找到相关信息"
     - "需要人工确认"
     - "基于XX文档推断(不确定)"

4. **多来源有矛盾时,列出所有观点**
   - 不擅自判断哪个正确
   - 明确列出:
     - 观点A:来源X
     - 观点B:来源Y
     - 建议:需要人工核实

---

## 执行逻辑

### 1. 分析主题和知识库
- 读取知识库索引文件
- 识别与主题相关的文档类别
- 确定可用的数据类型(文本/表格/图表)

### 2. 根据报告类型生成大纲框架

#### Research Report(研究报告)
```markdown
1. 摘要(Executive Summary)
2. 背景与目的(Background & Objectives)
3. 方法论(Methodology)
4. 主要发现(Key Findings)
   - 4.1 数据分析
   - 4.2 趋势识别
5. 讨论(Discussion)
6. 结论与建议(Conclusions & Recommendations)
7. 参考文献(References)
```

#### Summary Report(总结报告)
```markdown
1. 概述(Overview)
2. 关键要点(Key Points)
3. 重要数据(Critical Data)
4. 下一步行动(Next Steps)
```

#### Comparison Report(对比报告)
```markdown
1. 对比目标介绍
2. 方法论
3. 逐项对比
   - 3.1 维度1
   - 3.2 维度2
4. 综合对比矩阵
5. 结论
```

#### Analysis Report(分析报告)
```markdown
1. 问题陈述
2. 数据来源
3. 分析方法
4. 结果
   - 4.1 定量分析
   - 4.2 定性分析
5. 洞察与建议
```

### 3. 为每个章节分配数据源

对大纲中的每个章节:
- 使用 `smart-retrieval` Skill 找到相关文档
- 标注需要使用的 Skill(官方或自定义)
- 预估所需内容长度

示例:
```json
{
  "chapter": 1,
  "title": "摘要",
  "sections": [
    {
      "title": "1.1 背景",
      "required_skill": "summarize-documents",
      "source_documents": ["doc1.pdf", "doc2.docx"],
      "target_length": 200
    }
  ]
}
```

### 4. 输出结构化大纲

返回 JSON 格式:
```json
{
  "report_title": "...",
  "report_type": "research",
  "outline": [
    {
      "chapter": 1,
      "title": "摘要",
      "sections": [...]
    }
  ],
  "estimated_pages": 12,
  "estimated_time": "5 minutes"
}
```

---

### 步骤 5: 内容填充规则 ⭐ 新增 (来自文章启发)

在实际生成报告内容时,必须遵循以下规则:

#### 5.1 强制引用格式

所有事实性陈述必须使用以下格式之一:

**格式 A: 内联引用(推荐)**
```markdown
根据《技术方案设计》(第5页),项目采用微服务架构...
```

**格式 B: 脚注引用**
```markdown
项目采用微服务架构[1]。

---
[1] 来源:《技术方案设计》第5页
```

**格式 C: 表格数据引用**
```markdown
| 指标 | 数值 | 来源 |
|------|------|------|
| QPS | 10000 | 《性能测试报告》Sheet1,A10 |
```

#### 5.2 使用 extract-key-facts Skill

在填充报告内容前,优先查询事实索引:

```markdown
1. 调用 extract-key-facts skill 查询相关事实
2. 如果索引中有 → 直接引用(已带来源标注)
3. 如果索引中没有 → 读取原文档并标注来源
```

#### 5.3 禁止行为

❌ **绝对禁止**:
- 编造数据:"项目预算约为500万"(没有文档支撑)
- 使用AI知识:"微服务架构是一种先进的架构模式..."(来自训练数据)
- 省略来源:"项目于2024年1月启动"(没有标注来源)
- 模糊表述:"根据相关文档..."(没有具体指明哪个文档)

✅ **正确做法**:
- 明确来源:"根据《项目计划书》(第3页),预算为500万"
- 区分知识类型:"微服务架构(一种软件架构模式)在本项目中的应用..."
- 标注缺失:"文档库中未找到预算信息,建议补充《预算表》"

---

### 步骤 6: 三遍审校机制 ⭐ 新增 (来自文章启发)

报告生成后,自动执行三遍审校:

#### 第一遍: 内容审校(事实、逻辑、结构)

检查清单:
- [ ] 所有数据都有来源标注?
- [ ] 逻辑链条清晰,前后无矛盾?
- [ ] 结构合理,无跑题?
- [ ] 无编造内容?(所有信息来自文档或明确标注"AI知识")
- [ ] 多来源矛盾已明确列出?

**如果发现问题**: 标记并修正

---

#### 第二遍: 风格审校(去AI味)

删除AI套话:
```
❌ "在当今时代"
❌ "综上所述"
❌ "值得注意的是"
❌ "充分利用"
❌ "显著提升"
❌ "不断优化"
```

替换书面词汇:
```
❌ "显著提升" → ✅ 具体数字(如"提升30%")
❌ "充分利用" → ✅ "用好"、"使用"
❌ "进行操作" → ✅ 直接用动词
❌ "相关数据显示" → ✅ "根据《XX报告》,数据显示"
```

拆解AI句式:
```
❌ "不是...而是..."连续出现
❌ "首先...其次...最后..."过于机械
✅ 多样化表达,自然过渡
```

加入具体细节:
```
❌ "项目进展顺利"
✅ "截至2024年9月,已完成80%的开发任务(来源:《月报-2024-09》)"
```

---

#### 第三遍: 细节打磨(节奏、排版)

检查清单:
- [ ] 句子长度合适?(15-25字为主,不超过30字)
- [ ] 段落不太长?(3-5行)
- [ ] 标点自然?(多用句号,少用逗号连接长句)
- [ ] 节奏有变化?(快慢结合,长短句交替)
- [ ] 专业术语首次出现有解释?
- [ ] 图表和表格有标题和说明?

**优化示例**:

❌ 优化前:
```
根据相关文档显示,项目在技术架构方面采用了微服务架构,并且在数据库选型上选择了Redis作为缓存方案,同时在消息队列方面使用了Kafka,这些技术选型都是经过充分调研和讨论后确定的。
```

✅ 优化后:
```
技术架构方面,项目采用微服务架构(《技术方案》第5页)。

具体选型:
- 缓存方案: Redis(支持数据持久化,性能优于Memcached)
- 消息队列: Kafka(支持高吞吐量,团队熟悉度高)

来源: 《技术选型讨论纪要》2024-02-10
```

---

### 步骤 7: 生成最终报告

应用所有审校修改,输出最终 Word/Markdown 格式报告。

**报告末尾必须包含**:
```markdown
## 📚 参考文献

本报告基于以下文档生成:

1. 《技术方案设计》- /path/to/doc.pdf - 修改时间: 2024-02-10
2. 《性能测试报告》- /path/to/test.xlsx - 修改时间: 2024-03-20
3. 《项目月报-2024-09》- /path/to/report.docx - 修改时间: 2024-09-30
...

⚠️  说明:
- 所有标注来源的信息均可追溯到上述文档
- 未标注来源的通用知识(如技术术语解释)来自AI知识库
- 如有疑问或需要验证,请查阅原文档
```

---

## 使用示例

```markdown
使用 /skill custom/report-structure:
- topic: "2024年项目执行情况分析"
- report_type: "analysis"
- audience: "executive"
- knowledge_base_path: /path/to/docs

返回: 报告大纲(JSON)
```
