# 智能文档格式克隆功能说明

## 📖 功能概述

**智能文档格式克隆**是一个强大的工具,能够完全模仿参考文档的格式和排版,生成内容不同但格式完全一致的新Word文档。

### 核心价值

✅ **格式完全克隆** - 样式、字体、段落格式、页面设置完全保持一致
✅ **生成Word文档** - 输出标准 .docx 文件,可直接编辑使用
✅ **模板+填充机制** - 先提取格式模板,再智能填充新内容
✅ **交互式信息收集** - 引导用户输入项目特定信息

### 典型用例

**场景**: 你有一个A项目的智能建造实施方案文档,现在需要为B项目生成一个格式完全一样的文档。

**传统做法**: 手动复制文档,逐个替换内容,耗时且容易遗漏或格式错乱。

**使用本工具**:
1. 提供A项目文档作为参考
2. 输入B项目的基本信息
3. 自动生成格式完全一致的B项目文档

---

## 🚀 快速开始

### 使用命令

```bash
/notebook-clone-format <参考文档.docx>
```

### 完整示例

```bash
# 1. 准备参考文档(A项目的文档)
# 例如: ~/Documents/A项目-智能建造实施方案.docx

# 2. 运行命令
/notebook-clone-format ~/Documents/A项目-智能建造实施方案.docx

# 3. 根据提示输入B项目信息
#    - 项目名称: B项目智能建造示范工程
#    - 建设地点: 北京市朝阳区
#    - 建设单位: 某某建设集团
#    ... (其他信息可选,留空则从知识库推断)

# 4. 等待生成完成
#    输出: notebooklm-outputs/B项目智能建造示范工程-实施方案-20251108.docx
```

---

## 📋 执行流程

### Phase 1: 提取模板

系统会分析参考文档,提取:
- 📐 页面设置(纸张大小、边距)
- 🎨 样式信息(字体、颜色、对齐方式)
- 📑 文档结构(章节层级、标题样式)
- 📝 占位符字段(如 [项目名称]、_____ 等)

**输出**: 一个包含完整格式信息的模板JSON文件

### Phase 2: 收集信息

交互式收集项目特定信息:

**必需字段**(必须提供):
- 项目名称
- 建设地点
- 建设单位

**可选字段**(可留空):
- 项目规模
- 建设工期
- 投资金额

### Phase 3: 生成内容

根据:
- 模板的章节结构
- 用户提供的项目信息
- 章节标题关键词匹配

生成对应的内容段落。

### Phase 4: 输出Word文档

使用 python-docx 库:
- 应用提取的页面设置
- 应用提取的样式信息
- 按照原始结构生成段落
- 保存为标准 .docx 文件

---

## 📁 输出文件

生成完成后,会在 `notebooklm-outputs/` 目录下生成:

1. **Word文档** - `{项目名称}-实施方案-{日期}.docx`
   - 格式与参考文档完全一致
   - 内容基于用户信息和模板结构
   - 可直接在 Word 中编辑

2. **内容JSON** - `{项目名称}-内容-{日期}.json`
   - 包含生成的所有内容
   - 用于调试和二次编辑
   - 可重新填充模板

---

## 🔧 技术实现

### 核心脚本

本功能由3个Python脚本实现:

#### 1. `extract_template.py`
**功能**: 从Word文档提取格式模板

**输入**: Word文档 (.docx)
**输出**: 模板JSON文件

**提取内容**:
- 页面设置(宽度、高度、边距)
- 样式信息(段落样式、字体样式)
- 文档结构(章节、标题层级)
- 占位符字段

**示例**:
```bash
python extract_template.py template.docx output_template.json
```

#### 2. `fill_template.py`
**功能**: 使用模板和内容生成新Word文档

**输入**:
- 模板JSON文件
- 内容JSON文件

**输出**: 新的Word文档

**处理过程**:
- 创建新文档
- 应用页面设置
- 按模板格式生成章节和段落
- 应用样式和格式

**示例**:
```bash
python fill_template.py template.json content.json output.docx
```

#### 3. `clone_format.py`
**功能**: 主命令脚本,整合完整流程

**执行流程**:
1. 调用 `extract_template.py` 提取模板
2. 交互式收集用户信息
3. 基于模板生成内容JSON
4. 调用 `fill_template.py` 生成文档

**示例**:
```bash
python clone_format.py reference.docx
```

### 依赖库

- **python-docx** - Word文档操作
- **json** - 模板和内容序列化
- **pathlib** - 文件路径处理

---

## 💡 最佳实践

### 参考文档准备

**推荐**:
- 使用 .docx 格式(Office 2007及以上)
- 章节结构清晰(使用标题样式)
- 格式统一规范
- 可包含占位符(如 [项目名称])

**避免**:
- 过于复杂的格式(多栏、嵌套表格)
- 大量图片和图表
- 特殊字体和效果

### 信息提供

**必需字段**:
- 务必填写完整
- 使用全称,避免缩写
- 确保准确无误

**可选字段**:
- 如有准确信息请提供
- 不确定可留空
- 系统会基于章节内容生成默认值

### 文档审阅

生成文档后建议:
1. 在Word中打开审阅
2. 检查项目特定信息是否准确
3. 根据实际情况调整内容
4. 补充图表、数据等

---

## ⚠️ 注意事项

### 当前限制

1. **内容生成**: 当前版本生成示例内容,未集成知识库检索
2. **复杂格式**: 部分复杂格式可能无法完全复制(如表格、图片)
3. **样式应用**: 自定义样式可能需要手动调整

### 后续增强

计划增强功能:
- ✨ 集成知识库检索和内容生成
- ✨ 支持表格格式克隆
- ✨ 支持图片位置保留
- ✨ 多样化改写(降低查重率)

---

## 📞 获取帮助

### 查看帮助

```bash
/notebook-help
```

### 仅提取模板

如果只想提取模板,不生成文档:

```bash
python /home/user/construction-marketplace/plugins/notebooklm-assistant/scripts/clone_format.py reference.docx --template-only
```

### 常见问题

**Q: 生成的文档格式不一致怎么办?**
A: 检查参考文档是否使用标准样式(标题1、标题2等),避免手动设置格式。

**Q: 可以修改生成的内容吗?**
A: 可以。生成的是标准Word文档,可以直接在Word中编辑。

**Q: 如何重新使用同一个模板?**
A: 使用 `--template-only` 提取模板后,可以编辑内容JSON文件,然后用 `fill_template.py` 生成多个文档。

---

**NotebookLM Assistant - 智能文档格式克隆**
版本: v1.0
最后更新: 2025-11-08
